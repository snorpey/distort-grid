/**
 * almond 0.2.6 Copyright (c) 2011-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

// MIT license

/** @license
 * JS Signals <http://millermedeiros.github.com/js-signals/>
 * Released under the MIT license
 * Author: Miller Medeiros
 * Version: 1.0.0 - Build: 268 (2012/11/29 05:48 PM)
 */

!function(){var requirejs,require,define;!function(e){function t(e,t){return v.call(e,t)}function n(e,t){var n,i,r,s,a,o,l,u,c,d,f=t&&t.split("/"),p=m.map,h=p&&p["*"]||{};if(e&&"."===e.charAt(0))if(t){for(f=f.slice(0,f.length-1),e=f.concat(e.split("/")),u=0;u<e.length;u+=1)if("."===(d=e[u]))e.splice(u,1),u-=1;else if(".."===d){if(1===u&&(".."===e[2]||".."===e[0]))break;u>0&&(e.splice(u-1,2),u-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((f||h)&&p){for(n=e.split("/"),u=n.length;u>0;u-=1){if(i=n.slice(0,u).join("/"),f)for(c=f.length;c>0;c-=1)if((r=p[f.slice(0,c).join("/")])&&(r=r[i])){s=r,a=u;break}if(s)break;!o&&h&&h[i]&&(o=h[i],l=u)}!s&&o&&(s=o,a=l),s&&(n.splice(0,a,s),e=n.join("/"))}return e}function i(t,n){return function(){return c.apply(e,y.call(arguments,0).concat([t,n]))}}function r(e){return function(t){return n(t,e)}}function s(e){return function(t){p[e]=t}}function a(n){if(t(h,n)){var i=h[n];delete h[n],g[n]=!0,u.apply(e,i)}if(!t(p,n)&&!t(g,n))throw new Error("No "+n);return p[n]}function o(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function l(e){return function(){return m&&m.config&&m.config[e]||{}}}var u,c,d,f,p={},h={},m={},g={},v=Object.prototype.hasOwnProperty,y=[].slice;d=function(e,t){var i,s=o(e),l=s[0];return e=s[1],l&&(l=n(l,t),i=a(l)),l?e=i&&i.normalize?i.normalize(e,r(t)):n(e,t):(e=n(e,t),s=o(e),l=s[0],e=s[1],l&&(i=a(l))),{f:l?l+"!"+e:e,n:e,pr:l,p:i}},f={require:function(e){return i(e)},exports:function(e){var t=p[e];return void 0!==t?t:p[e]={}},module:function(e){return{id:e,uri:"",exports:p[e],config:l(e)}}},u=function(n,r,o,l){var u,c,m,v,y,w,_=[];if(l=l||n,"function"==typeof o){for(r=!r.length&&o.length?["require","exports","module"]:r,y=0;y<r.length;y+=1)if(v=d(r[y],l),"require"===(c=v.f))_[y]=f.require(n);else if("exports"===c)_[y]=f.exports(n),w=!0;else if("module"===c)u=_[y]=f.module(n);else if(t(p,c)||t(h,c)||t(g,c))_[y]=a(c);else{if(!v.p)throw new Error(n+" missing "+c);v.p.load(v.n,i(l,!0),s(c),{}),_[y]=p[c]}m=o.apply(p[n],_),n&&(u&&u.exports!==e&&u.exports!==p[n]?p[n]=u.exports:m===e&&w||(p[n]=m))}else n&&(p[n]=o)},requirejs=require=c=function(t,n,i,r,s){return"string"==typeof t?f[t]?f[t](n):a(d(t,n).f):(t.splice||(m=t,n.splice?(t=n,n=i,i=null):t=e),n=n||function(){},"function"==typeof i&&(i=r,r=s),r?u(e,t,n,i):setTimeout(function(){u(e,t,n,i)},4),c)},c.config=function(e){return m=e,m.deps&&c(m.deps,m.callback),c},requirejs._defined=p,define=function(e,n,i){n.splice||(i=n,n=[]),t(p,e)||t(h,e)||(h[e]=[e,n,i])},define.amd={jQuery:!0}}(),define("lib/almond-0.2.6",function(){}),define("util/canvas",[],function(){function e(e,t){e.width!==t.width&&(e.width=t.width,n=!0),e.height!==t.height&&(e.height=t.height,n=!0),n&&(e.width=t.width,e.height=t.height),n=!1}function t(e,t){t.clearRect(t,0,0,e.width,e.height)}var n=!1;return{resize:e,clear:t}}),define("util/imagedata-contrast",[],function(){function e(e,o){for(a=parseInt(o,10)>1?parseInt(o,10):10,n=e.data.length,i=1/0,r=0,t=0;t<n;t+=4*a)s=e.data[t]+e.data[t+1]+e.data[t+2],s<i&&(i=s),s>r&&(r=s);return(r-i)/765}var t,n,i,r,s,a=20;return e}),define("util/distort",["util/canvas","util/imagedata-contrast"],function(e,t){function n(t,n,r,s){d=s,p.clearRect(0,0,f.width,f.height),e.resize(f,t),i(t,n,r)}function i(e,t,n){u=t.length;var i=[];for(o=0;o<u;o++)r(p,e,t,t[o],n,i);d(p.getImageData(0,0,f.width,f.height),i)}function r(e,t,n,i,r,o){var l=a(n,"row",i.row+1,"column",i.column),u=a(n,"row",i.row,"column",i.column+1),c=a(n,"row",i.row+1,"column",i.column+1);if(i&&u&&l&&c){var d=s(0,0,i.x_end,r,0,u.x_end,0,r,l.x_end),f=s(0,0,i.y_end,r,0,u.y_end,0,r,l.y_end),p=s(r,r,c.x_end,r,0,u.x_end,0,r,l.x_end),h=s(r,r,c.y_end,r,0,u.y_end,0,r,l.y_end);e.save(),e.setTransform(d[0],f[0],d[1],f[1],d[2],f[2]),e.beginPath(),e.moveTo(-1,-1),e.lineTo(r+1,-1),e.lineTo(-1,r+1),e.lineTo(-1,-1),e.closePath(),e.clip(),d[0]!==f[1]?e.drawImage(t,i.x,i.y,r,r,-1,-1,r+1,r+1):e.drawImage(t,i.x,i.y,r,r,0,0,r,r),e.restore(),e.save(),o.push({points:[{x:i.x,y:i.y},{x:u.x,y:u.y},{x:l.x,y:l.y},{x:c.x,y:c.y}],transforms:{shape:{scaleX:d[0],skewX:f[0],scaleY:d[1],skewY:f[1],translateX:d[2],translateY:f[2]},image:{scaleX:p[0],skewX:h[0],scaleY:p[1],skewY:h[1],translateX:p[2],translateY:h[2]}}}),e.setTransform(p[0],h[0],p[1],h[1],p[2],h[2]),e.beginPath(),e.moveTo(r,r),e.lineTo(r,0),e.lineTo(r-1,0),e.lineTo(-1,r),e.lineTo(0,r),e.lineTo(r,r),e.closePath(),e.clip(),p[0]!==h[1]?e.drawImage(t,i.x,i.y,r,r,-1,-1,r+1,r+1):e.drawImage(t,i.x,i.y,r,r,0,0,r,r),e.restore()}}function s(e,t,n,i,r,s,a,o,l){e=parseFloat(e),t=parseFloat(t),n=parseFloat(n),i=parseFloat(i),r=parseFloat(r),s=parseFloat(s),a=parseFloat(a),o=parseFloat(o),l=parseFloat(l);var u=((s-l)*(t-r)-(n-s)*(r-o))/((i-a)*(t-r)-(e-i)*(r-o)),c=((s-l)*(e-i)-(n-s)*(i-a))/((r-o)*(e-i)-(t-r)*(i-a));return[u,c,n-e*u-t*c]}function a(e,t,n,i,r){var s;for(c=e.length,l=0;l<c;l++)if(e[l][t]===n&&e[l][i]===r){s=e[l];break}return s}var o,l,u,c,d,f=document.createElement("canvas"),p=f.getContext("2d");return n}),function(){for(var e=0,t=["ms","moz","webkit","o"],n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,n){var i=(new Date).getTime(),r=Math.max(0,16-(i-e)),s=window.setTimeout(function(){t(i+r)},r);return e=i+r,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),define("lib/raf",function(){}),define("src/process",["util/distort","util/canvas","lib/raf"],function(e,t){function n(e){p=e.signals,p["image-loaded"].add(s),p["points-updated"].add(r),p["control-updated"].add(i),p["image-data-url-requested"].add(u)}function i(e){d=c(e),a()}function r(e){h=e,a()}function s(e){v||(f=e,o(f))}function a(){f?o(f):v=!1}function o(n){v=!0,t.resize(m,n),f&&h&&d&&e(f,h,d.gridsize,l)}function l(e,n){g.clearRect(0,0,m.width,m.height),t.resize(m,e),g.putImageData(e,0,0),v=!1,e=null,n&&p["data-updated"].dispatch(n)}function u(e){"function"==typeof e&&e(m.toDataURL("image/png"))}function c(e){var t={};for(var n in e)t[n]=parseInt(e[n],10);return n=null,t}var d,f,p,h,m=document.getElementById("image-canvas"),g=m.getContext("2d"),v=!1;return{init:n}}),define("util/collection",[],function(){function e(e,r,s,a,o){for(i=void 0,t=e.length,n=0,n=0;n<t;n++)if(e[n][r]===s&&e[n][a]===o){i=e[n];break}return i}var t,n,i;return{getItemByValue:e}}),define("src/grid-canvas",["util/canvas","util/collection"],function(e,t){function n(e){y=e.signals,w=document.getElementById("grid-canvas"),_=w.getContext("2d"),h(),i(),y["control-updated"].add(r),y["image-loaded"].add(p),y["image-loaded"].add(h),y["image-loaded"].add(d)}function i(){w.addEventListener("mousedown",s),w.addEventListener("mousemove",o),w.addEventListener("mouseup",a),w.addEventListener("mouseout",u),w.addEventListener("mouseover",l)}function r(e){e.gridsize!==T&&(T=parseInt(e.gridsize,10),h(),d())}function s(e){b=!0,c(e)}function a(e){b=!1,c(e)}function o(e){c(e)}function l(e){E=!0}function u(){E=!1,b=!1,d()}function c(e){L=k,void 0!==e.offsetX&&void 0!==e.offsetY?(k.x=e.offsetX,k.y=e.offsetY):(k.x=e.layerX,k.y=e.layerY),d()}function d(){x=g(q,k),E&&b&&(x.x_end=k.x,x.y_end=k.y,y["points-updated"].dispatch(q)),_.clearRect(0,0,w.width,w.height),f(_,q),x&&E&&(_.beginPath(),_.fillStyle="#0066ff",_.lineWidth=3,_.strokeStyle="#cccccc",_.arc(x.x_end,x.y_end,4,0,2*Math.PI,!0),_.stroke(),_.fill(),_.closePath())}function f(e,n){for(var i,r,s,a,o=0;o<n.length;o++)i=n[o],r=t.getItemByValue(n,"row",i.row+1,"column",i.column),s=t.getItemByValue(n,"row",i.row,"column",i.column+1),a=t.getItemByValue(n,"row",i.row+1,"column",i.column+1),i&&r&&s&&a&&(e.beginPath(),e.moveTo(i.x_end,i.y_end),e.lineTo(s.x_end,s.y_end),e.lineTo(a.x_end,a.y_end),e.lineTo(r.x_end,r.y_end),e.lineTo(i.x_end,i.y_end),e.lineWidth=E?.4:.1,e.strokeStyle="#000000",e.stroke(),e.closePath())}function p(t){e.resize(w,t)}function h(){q=m(),y["points-updated"].dispatch(q)}function m(){var e=[],t=0,n=0,i=0,r=0,s=0,a=w.width,o=w.height;for(r=0;r<a;r+=T){for(n=0,s=0;s<o;s+=T)e[i]={x:r,y:s,x_end:r,y_end:s,column:t,row:n,index:i},i++,n++;t++}return e}function g(e,t){var n,i=0,r=e.length,s=1/0,a=1/0;for(i=0;i<r;i++)(a=v({x:e[i].x_end,y:e[i].y_end},t))<s&&(s=a,n=e[i]);return n}function v(e,t){var n=0,i=0;return n=t.x-e.x,n*=n,i=t.y-e.y,i*=i,Math.sqrt(n+i)}var y,w,_,b,x,q=[],E=!1,k={x:0,y:0},L=k,T=50;return{init:n}}),define("src/image",[],function(){function e(e){i=e.signals,r=new Image,i["set-new-src"].add(n),r.addEventListener("load",t,!1),n(a)}function t(){i["image-loaded"].dispatch(r),s=!0}function n(e){r.src=e,s&&void 0!==r.naturalWidth&&0!==r.naturalWidth&&setTimeout(t,10)}var i,r,s=!1,a=document.body.getAttribute("data-defaultimage");return{init:e}}),define("src/file",[],function(){function e(e){i=e.signals,s=e.feature,s["file-api"]&&(i["load-file"].add(t),r=new FileReader,r.addEventListener("load",n,!1))}function t(e){e&&e.type&&-1!==a.indexOf(e.type)&&r.readAsDataURL(e)}function n(e){i["set-new-src"].dispatch(e.target.result)}var i,r,s,a=["image/png","image/jpg","image/jpeg"];return{init:e}}),define("src/dragdrop",[],function(){function e(e){r=e.feature,i=e.signals,r["drag-drop"]&&(document.addEventListener("drop",n,!1),document.addEventListener("dragover",t,!1),document.addEventListener("dragleave",t,!1))}function t(e){e.preventDefault()}function n(e){e.preventDefault(),e.dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files[0]&&(i["load-file"].dispatch(e.dataTransfer.files[0]),i["close-intro"].dispatch())}var i,r;return{init:e}}),define("src/controls",[],function(){function e(e){if(o=e.signals,e.feature["query-selector-all"]){var d=document.getElementById("controls");l=d.querySelectorAll(".control-input"),d.className+=" is-active";for(var f=0;f<l.length;f++){var p=l[f];p.addEventListener("input",t,!1),i(a(p.id),p.value),r(s(p.id),p.value)}c=!0,o["control-set"].add(n),o["control-updated"].dispatch(u)}}function t(e){e.target&&(e=e.target),i(a(e.id),e.value),r(s(e.id),e.value)}function n(e){var n,i={};for(var r in e)n=s(r),n.value=e[r],t(n),i[a(r)]=e[r];u=i,o["control-updated"].dispatch(u)}function i(e,t){u[e]=t,c&&o["control-updated"].dispatch(u)}function r(e,t){e.value!==t&&(e.value=t)}function s(e){for(var t,n,i=a(e),r=0,s=l.length;r<s;r++)if((n=l[r].id)!==e&&-1!==n.indexOf(i)){t=l[r];break}return t}function a(e){return e.replace("-slider","").replace("-number","")}var o,l,u={},c=!1;return{init:e}}),define("src/export-button",[],function(){function e(e){r=e.signals,s=document.getElementById("export-button"),a=document.getElementById("png-button"),s.addEventListener("click",t,!1),a.addEventListener("click",i,!1)}function t(e){e.preventDefault(),r["image-data-url-requested"].dispatch(n)}function n(e){a.href=e,a.classList.add("is-active")}function i(){a.classList.remove("is-active")}var r,s,a;return{init:e}}),define("util/trigger-event",[],function(){function e(e,t){var n;if(e.ownerDocument)n=e.ownerDocument;else{if(9!==e.nodeType)throw new Error("Invalid node passed to fireEvent: "+e.id);n=e}if(e.fireEvent){var i=n.createEventObject();i.synthetic=!0,e.fireEvent("on"+t,i)}else if(e.dispatchEvent){var r="";switch(t){case"click":case"mousedown":case"mouseup":r="MouseEvents";break;case"focus":case"change":case"blur":case"select":r="HTMLEvents";break;default:throw"triggerEvent: Couldn’t find an event class for event "+t+"."}var i=n.createEvent(r),s="change"!=t;i.initEvent(t,s,!0),i.synthetic=!0,e.dispatchEvent(i)}}return e}),define("src/import-button",["util/trigger-event"],function(e){function t(e){s=e.signals,r=e.feature,r["file-api"]&&(l=new FileReader,a=document.getElementById("import-button"),o=document.getElementById("import-input"),a.addEventListener("click",n,!1),o.addEventListener("change",i,!1))}function n(t){t.preventDefault(),u||e(o,"click")}function i(e){e.target.files;e.target&&e.target.files&&e.target.files[0]&&(s["load-file"].dispatch(e.target.files[0]),s["close-intro"].dispatch())}var r,s,a,o,l,u=!1;return{init:t}}),define("src/data-button",[],function(){function e(e){n=e.signals,i=document.getElementById("data-button"),a?e.signals["data-updated"].add(t):i.parentNode.removeChild(i)}function t(e){window.URL&&(clearTimeout(r),r=setTimeout(function(){s&&URL.revokeObjectURL(s);var t=new Blob([JSON.stringify(e,null,"\t")],{type:"application/json"});s=URL.createObjectURL(t),i.href=s},200))}var n,i,r=NaN,s=null,a=!!window.URL&&!!window.Blob;return{init:e}}),function(e,t,n){"undefined"!=typeof module&&module.exports?module.exports=n():"function"==typeof define&&define.amd?define("lib/reqwest",n):t.reqwest=n()}(0,this,function(){function handleReadyState(e,t,n){return function(){if(e._aborted)return n(e.request);e.request&&4==e.request[readyState]&&(e.request.onreadystatechange=noop,twoHundo.test(e.request.status)?t(e.request):n(e.request))}}function setHeaders(e,t){var n,i=t.headers||{};i.Accept=i.Accept||defaultHeaders.accept[t.type]||defaultHeaders.accept["*"],t.crossOrigin||i[requestedWith]||(i[requestedWith]=defaultHeaders.requestedWith),i[contentType]||(i[contentType]=t.contentType||defaultHeaders.contentType);for(n in i)i.hasOwnProperty(n)&&"setRequestHeader"in e&&e.setRequestHeader(n,i[n])}function setCredentials(e,t){void 0!==t.withCredentials&&void 0!==e.withCredentials&&(e.withCredentials=!!t.withCredentials)}function generalCallback(e){lastValue=e}function urlappend(e,t){return e+(/\?/.test(e)?"&":"?")+t}function handleJsonp(e,t,n,i){var r=uniqid++,s=e.jsonpCallback||"callback",a=e.jsonpCallbackName||reqwest.getcallbackPrefix(r),o=new RegExp("((^|\\?|&)"+s+")=([^&]+)"),l=i.match(o),u=doc.createElement("script"),c=0,d=-1!==navigator.userAgent.indexOf("MSIE 10.0");return l?"?"===l[3]?i=i.replace(o,"$1="+a):a=l[3]:i=urlappend(i,s+"="+a),win[a]=generalCallback,u.type="text/javascript",u.src=i,u.async=!0,void 0===u.onreadystatechange||d||(u.event="onclick",u.htmlFor=u.id="_reqwest_"+r),u.onload=u.onreadystatechange=function(){if(u[readyState]&&"complete"!==u[readyState]&&"loaded"!==u[readyState]||c)return!1;u.onload=u.onreadystatechange=null,u.onclick&&u.onclick(),t(lastValue),lastValue=void 0,head.removeChild(u),c=1},head.appendChild(u),{abort:function(){u.onload=u.onreadystatechange=null,n({},"Request is aborted: timeout",{}),lastValue=void 0,head.removeChild(u),c=1}}}function getRequest(e,t){var n,i=this.o,r=(i.method||"GET").toUpperCase(),s="string"==typeof i?i:i.url,a=!1!==i.processData&&i.data&&"string"!=typeof i.data?reqwest.toQueryString(i.data):i.data||null,o=!1;return"jsonp"!=i.type&&"GET"!=r||!a||(s=urlappend(s,a),a=null),"jsonp"==i.type?handleJsonp(i,e,t,s):(n=xhr(i),n.open(r,s,!1!==i.async),setHeaders(n,i),setCredentials(n,i),win[xDomainRequest]&&n instanceof win[xDomainRequest]?(n.onload=e,n.onerror=t,n.onprogress=function(){},o=!0):n.onreadystatechange=handleReadyState(this,e,t),i.before&&i.before(n),o?setTimeout(function(){n.send(a)},200):n.send(a),n)}function Reqwest(e,t){this.o=e,this.fn=t,init.apply(this,arguments)}function setType(e){var t=e.match(/\.(json|jsonp|html|xml)(\?|$)/);return t?t[1]:"js"}function init(o,fn){function complete(e){for(o.timeout&&clearTimeout(self.timeout),self.timeout=null;self._completeHandlers.length>0;)self._completeHandlers.shift()(e)}function success(resp){resp="jsonp"!==type?self.request:resp;var filteredResponse=globalSetupOptions.dataFilter(resp.responseText,type),r=filteredResponse;try{resp.responseText=r}catch(e){}if(r)switch(type){case"json":try{resp=win.JSON?win.JSON.parse(r):eval("("+r+")")}catch(e){return error(resp,"Could not parse JSON in response",e)}break;case"js":resp=eval(r);break;case"html":resp=r;break;case"xml":resp=resp.responseXML&&resp.responseXML.parseError&&resp.responseXML.parseError.errorCode&&resp.responseXML.parseError.reason?null:resp.responseXML}for(self._responseArgs.resp=resp,self._fulfilled=!0,fn(resp),self._successHandler(resp);self._fulfillmentHandlers.length>0;)resp=self._fulfillmentHandlers.shift()(resp);complete(resp)}function error(e,t,n){for(e=self.request,self._responseArgs.resp=e,self._responseArgs.msg=t,self._responseArgs.t=n,self._erred=!0;self._errorHandlers.length>0;)self._errorHandlers.shift()(e,t,n);complete(e)}this.url="string"==typeof o?o:o.url,this.timeout=null,this._fulfilled=!1,this._successHandler=function(){},this._fulfillmentHandlers=[],this._errorHandlers=[],this._completeHandlers=[],this._erred=!1,this._responseArgs={};var self=this,type=o.type||setType(this.url);fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){self.abort()},o.timeout)),o.success&&(this._successHandler=function(){o.success.apply(o,arguments)}),o.error&&this._errorHandlers.push(function(){o.error.apply(o,arguments)}),o.complete&&this._completeHandlers.push(function(){o.complete.apply(o,arguments)}),this.request=getRequest.call(this,success,error)}function reqwest(e,t){return new Reqwest(e,t)}function normalize(e){return e?e.replace(/\r?\n/g,"\r\n"):""}function serial(e,t){var n,i,r,s,a=e.name,o=e.tagName.toLowerCase(),l=function(e){e&&!e.disabled&&t(a,normalize(e.attributes.value&&e.attributes.value.specified?e.value:e.text))};if(!e.disabled&&a)switch(o){case"input":/reset|button|image|file/i.test(e.type)||(n=/checkbox/i.test(e.type),i=/radio/i.test(e.type),r=e.value,(!(n||i)||e.checked)&&t(a,normalize(n&&""===r?"on":r)));break;case"textarea":t(a,normalize(e.value));break;case"select":if("select-one"===e.type.toLowerCase())l(e.selectedIndex>=0?e.options[e.selectedIndex]:null);else for(s=0;e.length&&s<e.length;s++)e.options[s].selected&&l(e.options[s])}}function eachFormElement(){var e,t,n=this;for(t=0;t<arguments.length;t++)e=arguments[t],/input|select|textarea/i.test(e.tagName)&&serial(e,n),function(e,t){var i,r,s;for(i=0;i<t.length;i++)for(s=e[byTag](t[i]),r=0;r<s.length;r++)serial(s[r],n)}(e,["input","select","textarea"])}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var e={};return eachFormElement.apply(function(t,n){t in e?(e[t]&&!isArray(e[t])&&(e[t]=[e[t]]),e[t].push(n)):e[t]=n},arguments),e}function buildParams(e,t,n,i){var r,s,a,o=/\[\]$/;if(isArray(t))for(s=0;t&&s<t.length;s++)a=t[s],n||o.test(e)?i(e,a):buildParams(e+"["+("object"==typeof a?s:"")+"]",a,n,i);else if(t&&"[object Object]"===t.toString())for(r in t)buildParams(e+"["+r+"]",t[r],n,i);else i(e,t)}var win=window,doc=document,twoHundo=/^20\d$/,byTag="getElementsByTagName",readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",head=doc[byTag]("head")[0],uniqid=0,callbackPrefix="reqwest_"+ +new Date,lastValue,xmlHttpRequest="XMLHttpRequest",xDomainRequest="XDomainRequest",noop=function(){},isArray="function"==typeof Array.isArray?Array.isArray:function(e){return e instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",requestedWith:xmlHttpRequest,accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"}},xhr=function(e){if(!0===e.crossOrigin){var t=win[xmlHttpRequest]?new XMLHttpRequest:null;if(t&&"withCredentials"in t)return t;if(win[xDomainRequest])return new XDomainRequest;throw new Error("Browser does not support cross-origin requests")}return win[xmlHttpRequest]?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")},globalSetupOptions={dataFilter:function(e){return e}};return Reqwest.prototype={abort:function(){this._aborted=!0,this.request.abort()},retry:function(){init.call(this,this.o,this.fn)},then:function(e,t){return e=e||function(){},t=t||function(){},this._fulfilled?this._responseArgs.resp=e(this._responseArgs.resp):this._erred?t(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):(this._fulfillmentHandlers.push(e),this._errorHandlers.push(t)),this},always:function(e){return this._fulfilled||this._erred?e(this._responseArgs.resp):this._completeHandlers.push(e),this},fail:function(e){return this._erred?e(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):this._errorHandlers.push(e),this}},reqwest.serializeArray=function(){var e=[];return eachFormElement.apply(function(t,n){e.push({name:t,value:n})},arguments),e},reqwest.serialize=function(){if(0===arguments.length)return"";var e,t,n=Array.prototype.slice.call(arguments,0);return e=n.pop(),e&&e.nodeType&&n.push(e)&&(e=null),e&&(e=e.type),t="map"==e?serializeHash:"array"==e?reqwest.serializeArray:serializeQueryString,t.apply(null,n)},reqwest.toQueryString=function(e,t){var n,i,r=t||!1,s=[],a=encodeURIComponent,o=function(e,t){t="function"==typeof t?t():null==t?"":t,s[s.length]=a(e)+"="+a(t)};if(isArray(e))for(i=0;e&&i<e.length;i++)o(e[i].name,e[i].value);else for(n in e)buildParams(n,e[n],r,o);return s.join("&").replace(/%20/g,"+")},reqwest.getcallbackPrefix=function(){return callbackPrefix},reqwest.compat=function(e,t){return e&&(e.type&&(e.method=e.type)&&delete e.type,e.dataType&&(e.type=e.dataType),e.jsonpCallback&&(e.jsonpCallbackName=e.jsonpCallback)&&delete e.jsonpCallback,e.jsonp&&(e.jsonpCallback=e.jsonp)),new Reqwest(e,t)},reqwest.ajaxSetup=function(e){e=e||{};for(var t in e)globalSetupOptions[t]=e[t]},reqwest}),define("src/upload-imgur",["lib/reqwest"],function(e,t){function n(e){l=e.signals,u=document.getElementById("imgur-button"),c=document.getElementById("imgur-url-container"),d=document.getElementById("imgur-url-input"),f=document.getElementById("imgur-url-link"),p=document.getElementById("imgur-url-error"),h=document.getElementById("twitter-link"),m=document.getElementById("facebook-link"),g=document.getElementById("reddit-link"),u.addEventListener("click",i,!1),d.addEventListener("click",r,!1)}function i(e){e.preventDefault(),v||(l["image-data-url-requested"].dispatch(s),c.classList.remove("is-active","upload-failed","upload-successful"))}function r(){d.select()}function s(t){v||(u.classList.add("is-uploading"),v=!0,e({url:"https://api.imgur.com/3/image.json",method:"POST",headers:{Authorization:"Client-ID a4c24380d884932"},data:{image:t.split(",")[1],type:"base64"},type:"json",crossOrigin:!0,success:a,error:o}))}function a(e){if(v=!1,e&&e.data&&e.data.link){var t="Check out what I made with @snorpey’s image distortion tool: ";t+=e.data.link,t+=" http://snorpey.github.io/distort-grid";var n="http://www.facebook.com/sharer.php?s=100";n+="&p[url]="+e.data.link,n+="&p[title]=BAAM!",n+="&p[images][0]="+e.data.link,n+="&p[summary]="+encodeURIComponent("Check out what I made with this image distortion tool: http://snorpey.github.io/distort-grid"),u.classList.remove("is-uploading"),d.setAttribute("value",e.data.link),f.href=e.data.link,c.classList.add("is-active","upload-successful"),h.href="https://twitter.com/intent/tweet?text="+encodeURIComponent(t),m.href=n,g.href="http://www.reddit.com/submit?url="+encodeURIComponent(e.data.link)}else o()}function o(e){v=!1,u.classList.remove("is-uploading"),c.classList.add("is-active","upload-failed")}var l,u,c,d,f,p,h,m,g,v=!1;return{init:n}}),define("src/intro",[],function(){function e(e){r=e.signals,o.addEventListener("click",t),l.addEventListener("click",i),r["close-intro"].add(i)}function t(e){s?i():n()}function n(){o.classList.add("is-active"),a.classList.add("is-active"),s=!0}function i(){o.classList.remove("is-active"),a.classList.remove("is-active"),s=!1}var r,s=!0,a=document.querySelectorAll(".intro")[0],o=document.querySelectorAll(".intro-button")[0],l=a.querySelectorAll(".close")[0];return{init:e}}),define("util/feature-test",[],function(){function e(e,n){var i=!0,r={},s=[];for(var a in t){var o=t[a].test();o||t[a].required&&(i=!1,s.push(a)),r[a]=o}i?e(r):n(s,r)}var t={canvas:{required:!0,test:function(){return!!document.createElement("canvas").getContext}},"query-selector-all":{required:!1,test:function(){return!!document.querySelectorAll}},"drag-drop":{required:!1,test:function(){return"draggable"in document.createElement("span")}},"file-api":{required:!1,test:function(){return"undefined"!=typeof FileReader}}};return e}),function(e){function t(e,t,n,i,r){this._listener=t,this._isOnce=n,this.context=i,this._signal=e,this._priority=r||0}function n(e,t){if("function"!=typeof e)throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",t))}function i(){this._bindings=[],this._prevParams=null;var e=this;this.dispatch=function(){i.prototype.dispatch.apply(e,arguments)}}t.prototype={active:!0,params:null,execute:function(e){var t,n;return this.active&&this._listener&&(n=this.params?this.params.concat(e):e,t=this._listener.apply(this.context,n),this._isOnce&&this.detach()),t},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},i.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(e,n,i,r){var s,a=this._indexOfListener(e,i);if(-1!==a){if(s=this._bindings[a],s.isOnce()!==n)throw new Error("You cannot add"+(n?"":"Once")+"() then add"+(n?"Once":"")+"() the same listener without removing the relationship first.")}else s=new t(this,e,n,i,r),this._addBinding(s);return this.memorize&&this._prevParams&&s.execute(this._prevParams),s},_addBinding:function(e){var t=this._bindings.length;do{--t}while(this._bindings[t]&&e._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,e)},_indexOfListener:function(e,t){for(var n,i=this._bindings.length;i--;)if(n=this._bindings[i],n._listener===e&&n.context===t)return i;return-1},has:function(e,t){return-1!==this._indexOfListener(e,t)},add:function(e,t,i){return n(e,"add"),this._registerListener(e,!1,t,i)},addOnce:function(e,t,i){return n(e,"addOnce"),this._registerListener(e,!0,t,i)},remove:function(e,t){n(e,"remove");var i=this._indexOfListener(e,t);return-1!==i&&(this._bindings[i]._destroy(),this._bindings.splice(i,1)),e},removeAll:function(){for(var e=this._bindings.length;e--;)this._bindings[e]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(e){if(this.active){var t,n=Array.prototype.slice.call(arguments),i=this._bindings.length;if(this.memorize&&(this._prevParams=n),i){t=this._bindings.slice(),this._shouldPropagate=!0;do{i--}while(t[i]&&this._shouldPropagate&&!1!==t[i].execute(n))}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var r=i;r.Signal=i,"function"==typeof define&&define.amd?define("lib/signals-1.0.0",[],function(){return r}):"undefined"!=typeof module&&module.exports?module.exports=r:e.signals=r}(this),requirejs.config({baseUrl:"scripts/",waitSeconds:5,urlArgs:"bust="+(new Date).getTime()}),require(["src/process","src/grid-canvas","src/image","src/file","src/dragdrop","src/controls","src/export-button","src/import-button","src/data-button","src/upload-imgur","src/intro","util/feature-test","lib/signals-1.0.0"],function(e,t,n,i,r,s,a,o,l,u,c,d,f){function p(d){var p={feature:d,signals:{"points-updated":new f,"load-file":new f,"image-loaded":new f,"set-new-src":new f,"control-set":new f,"control-updated":new f,"close-intro":new f,"image-data-url-requested":new f,"data-updated":new f}};e.init(p),t.init(p),r.init(p),s.init(p),a.init(p),o.init(p),l.init(p),n.init(p),i.init(p),u.init(p),c.init(p)}function h(e){var t=document.createElement("div"),n="sorry. it looks like your browser is missing some of the features ";n+="("+e.join(", ")+") that are required to run this ",n+="experiment.",t.innerText=n,t.className="missing-feature",document.getElementsByTagName("body")[0].appendChild(t)}d(p,h)}),define("main",function(){})}();